defmodule LooksLikeANailBackend.MapperTest do
  use ExUnit.Case, async: true

  alias LooksLikeANailBackend.Feature
  alias LooksLikeANailBackend.Mapper
  alias LooksLikeANailBackend.Implements
  alias LooksLikeANailBackend.IsCapableOf
  alias LooksLikeANailBackend.Task
  alias LooksLikeANailBackend.Tool

  @json_one_tool_first_row "{ \"row\": [ { \"title\": \"Elixir\", \"id\": 104, \"created\": 1437522726931, \"updated\": 1438197525156, \"subTitle\": \"Programming Langugage\", \"description\": \"Elixir is a functional...\" }, { \"id\": 3021 }, { \"title\": \"ecto\", \"id\": 302, \"created\": 1437522726931, \"updated\": 1437522726931 }, { \"id\": 3022 }, { \"title\": \"Connecting\", \"id\": 204, \"created\": 1437522726931, \"updated\": 1437522726931, \"subTitle\": \"Task\", \"description\": \"ConnectingDescription\" }, { \"id\": 3024 }, { \"title\": \"MySQL\", \"id\": 106, \"created\": 1437522726931, \"updated\": 1438195241244, \"subTitle\": \"Database\", \"description\": \"MySQL (/maɪ ˌɛskjuːˈɛl/ 'My S-Q-L',[6] officially...\" } ] }"
  @json_one_tool_second_row "{\"row\": [ { \"title\": \"Elixir\", \"id\": 104, \"created\": 1437522726931, \"updated\": 1438197525156, \"subTitle\": \"Programming Langugage\", \"description\": \"Elixir is a functional...\" }, { \"id\": 3021 }, { \"title\": \"ecto\", \"id\": 302, \"created\": 1437522726931, \"updated\": 1437522726931 }, { \"id\": 3022 }, { \"title\": \"Connecting\", \"id\": 204, \"created\": 1437522726931, \"updated\": 1437522726931, \"subTitle\": \"Task\", \"description\": \"ConnectingDescription\" }, { \"id\": 3023 }, { \"title\": \"Postgres\", \"id\": 105, \"created\": 1437522726931, \"updated\": 1438194844405, \"subTitle\": \"Database\", \"description\": \"PostgreSQL, often simply Postgres...\" } ]}"

  @json_implements1 "{\"id\": \"605\", \"type\": \"IMPLEMENTS\",
        \"startNode\": \"639\", \"endNode\": \"649\", \"properties\": {\"id\": 3051}}"

  @json_implements2 "{\"id\": \"606\",\"type\": \"IMPLEMENTS\",
        \"startNode\": \"639\", \"endNode\": \"650\", \"properties\": {\"id\": 3055}}"

  @json_is_capable_of "{\"id\": \"606\", \"type\": \"IS_CAPABLE_OF\",
        \"startNode\": \"649\", \"endNode\": \"641\", \"properties\": {\"id\": 3052}}"

  @json_feature "{\"id\": \"649\",\"labels\": [\"Feature\"],
        \"properties\": {\"title\": \"herokuHosting\",
        \"id\": 305, \"created\": 1437522726931,\"updated\": 1437522726931}}"

  @json_task "{\"id\": \"641\", \"labels\": [\"Task\"],
        \"properties\": {\"title\": \"Hosting\", \"id\": 202, \"created\": 1437522726931,
        \"updated\": 1437522726931, \"subTitle\": \"Task\",
        \"description\": \"HostingDescription\"}}"

  @json_row_one_tool_no_features "{ \"row\": [ { \"title\": \"Java\", \"id\": 101, \"created\": 1437522726931, \"updated\": 1438195114593, \"subTitle\": \"Programming Language\", \"description\": \"Java is a general-purpose computer programming language...\" }, null, null, null, null, null, null ] }"
  
  @columns ["tool","implements","feature","isCapableOf","task","supports","otherTool"]
  # test "map from neo" do
  #   neo_response = "{\"results\": [{\"columns\": [\"tool\",\"implements\",\"feature\",\"isCapableOf\",\"task\"],\"data\": [{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}},{\"graph\": {\"nodes\": [{\"id\": \"649\",\"labels\": [\"Feature\"],\"properties\": {\"title\": \"herokuHosting\",\"id\": 305,\"created\": 1437522726931,\"updated\": 1437522726931}},{\"id\": \"639\",\"labels\": [\"Tool\"],\"properties\": {\"title\": \"Heroku\",\"id\": 107,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Platform as a Service\",\"description\": \"HerokuDescription\"}},{\"id\": \"641\",\"labels\": [\"Task\"],\"properties\": {\"title\": \"Hosting\",\"id\": 202,\"created\": 1437522726931,\"updated\": 1437522726931,\"subTitle\": \"Task\",\"description\": \"HostingDescription\"}}],\"relationships\": [{\"id\": \"605\",\"type\": \"IMPLEMENTS\",\"startNode\": \"639\",\"endNode\": \"649\",\"properties\": {\"id\": 3051}},{\"id\": \"606\",\"type\": \"IS_CAPABLE_OF\",\"startNode\": \"649\",\"endNode\": \"641\",\"properties\": {\"id\": 3052}}]}}]}],\"errors\": []}"
  #   expected = %{:tool => %{:title => "Heroku",:id => 107,:subTitle => "Platform as a Service",:description => "HerokuDescription", :implements => [306], :created => 1437683566287,:updated => 1437683566287},
  #     :implements => [%{:id => 3055, :feature => 306, :tool => 107}],
  #     :features => [%{:title => "herokuBuilding", :id => 306, :created => 1437683566287, :updated => 1437683566287, :isCapableOf => [201]}],
  #     :isCapableOf => [%{:id => 3056, :feature => 306, :task => 201}],
  #     :tasks => [%{:title => "Building", :id => 201, :subTitle => "Task", :description => "BuildingDescription", :created => 1437683566287, :updated => 1437683566287}]
  #   }
  # }
  #   actual = Mapper.map_from_neo(Poison.decode!(neo_response))
  #   assert expected === actual
  # end

  test "map one tool two rows" do
    json1 = @json_one_tool_first_row
    json2 = @json_one_tool_second_row
    row1 = Poison.decode!(json1)
    row2 = Poison.decode!(json2)
    expected = %{ tool: %{id: 104, title: "Elixir", subTitle: "Programming Langugage", updated: 1438197525156, created: 1437522726931, description: "Elixir is a functional...", implements: [3021]},
      features: [%{id: 302, title: "ecto", updated: 1437522726931, created: 1437522726931, isCapableOf: [3022], supports: [3023,3024]}],
      tasks: [%{id: 204, title: "Connecting", updated: 1437522726931, created: 1437522726931, subTitle: "Task", description: "ConnectingDescription"}],
      implements: [%{id: 3021, tool: 104, feature: 302}],
      isCapableOf: [%{id: 3022, task: 204, feature: 302}],
      supports: [%{id: 3023, feature: 302, tool: 105},%{id: 3024, feature: 302, tool: 106}],
      tools: [%{title: "Postgres", id: 105, created: 1437522726931, updated: 1438194844405, subTitle: "Database", description: "PostgreSQL, often simply Postgres..." },
        %{id: 106, title: "MySQL", created: 1437522726931, updated: 1438195241244, subTitle: "Database", description: "MySQL (/maɪ ˌɛskjuːˈɛl/ 'My S-Q-L',[6] officially..."}]
    }
    actual = Mapper.map_single_entity(Tool, [row1, row2], @columns)
    assert expected[:tool] === actual[:tool]
    assert expected[:implements] === actual[:implements]
    assert expected[:features] === actual[:features]
    assert expected[:isCapableOf] === actual[:isCapableOf]
    assert expected[:tasks] === actual[:tasks]
    assert expected[:supports] === actual[:supports]
    assert expected[:tools] === actual[:tools]
  end

  test "map one tool one row" do
    json = @json_one_tool_first_row
    row = Poison.decode!(json)
    expected = %{ tool: %{id: 104, title: "Elixir", subTitle: "Programming Langugage", updated: 1438197525156, created: 1437522726931, description: "Elixir is a functional...", implements: [3021]},
      feature: %{id: 302, title: "ecto", updated: 1437522726931, created: 1437522726931, isCapableOf: [3022], supports: [3024]},
      task: %{id: 204, title: "Connecting", updated: 1437522726931, created: 1437522726931, subTitle: "Task", description: "ConnectingDescription"},
      implements: %{id: 3021, tool: 104, feature: 302},
      isCapableOf: %{id: 3022, task: 204, feature: 302},
      supports: %{id: 3024, feature: 302, tool: 106},
      otherTool: %{id: 106, title: "MySQL", created: 1437522726931, updated: 1438195241244, subTitle: "Database", description: "MySQL (/maɪ ˌɛskjuːˈɛl/ 'My S-Q-L',[6] officially..."}
    }
    actual = Mapper.map_one_row(Tool, row, @columns)
    assert expected === actual
  end

  test "map one tool row with no features" do
    json = @json_row_one_tool_no_features
    row = Poison.decode!(json)
    expected = %{ tool: %{id: 101, title: "Java", subTitle: "Programming Language", updated: 1438195114593, created: 1437522726931, description: "Java is a general-purpose computer programming language...", implements: []}}
    actual = Mapper.map_one_row(Tool, row, @columns)
    assert expected === actual
  end

  test "unify entities" do
    entities = [%{created: 1437522726931, id: 302, isCapableOf: [3022], supports: [3023],
      title: "ecto", updated: 1437522726931},
      %{created: 1437522726931, id: 302, isCapableOf: [3022], supports: [3024],
      title: "ecto", updated: 1437522726931}]
    expected = [%{created: 1437522726931, id: 302, isCapableOf: [3022], supports: [3023, 3024],
              title: "ecto", updated: 1437522726931}]
    actual = Mapper.unify_entity(entities, [:isCapableOf, :supports])
    assert expected === actual
  end
  
end